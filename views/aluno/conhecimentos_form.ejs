<%- include('../partials/header') %>

<h1>Gerenciar Meus Conhecimentos</h1>
<p>Selecione os conhecimentos que você domina e defina seu nível.</p>
<a href="/aluno/dashboard" class="btn btn-sm btn-secondary mb-3">Voltar ao Dashboard</a>

<div class="row">
    <div class="col-md-5">
        <div class="card shadow-sm">
            <div class="card-header">
                Adicionar Novo Conhecimento
            </div>
            <div class="card-body">
                <form action="/aluno/conhecimentos" method="POST">
                    
                    <div class="mb-3">
                        <label for="conhecimentoId" class="form-label">Conhecimento</label>
                        <select class="form-select" id="conhecimentoId" name="conhecimentoId" required>
                            <option value="">Selecione...</option>
                            <% if (conhecimentosDisponiveis && conhecimentosDisponiveis.length > 0) { %>
                                <% conhecimentosDisponiveis.forEach(c => { %>
                                    <option value="<%= c._id %>"><%= c.nome %></option>
                                <% }) %>
                            <% } %>
                        </select>
                        <div class="form-text">Conhecimentos cadastrados pelo Admin.</div>
                    </div>

                    <div class="mb-3">
                        <label for="nivel" class="form-label">Nível de Domínio: 
                            <output id="nivel-valor" for="nivel">5</output>/10
                        </label>
                        <input type="range" class="form-range" id="nivel" name="nivel" 
                               min="0" max="10" value="5" 
                               oninput="document.getElementById('nivel-valor').value = this.value">
                    </div>

                    <button type="submit" class="btn btn-success">Adicionar</button>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-7">
        <div class="card shadow-sm">
            <div class="card-header">
                Meus Conhecimentos Atuais
            </div>
            <ul class="list-group list-group-flush">
                <% if (meusConhecimentos && meusConhecimentos.length > 0) { %>
                    <% meusConhecimentos.forEach(mc => { %>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong><%= mc.conhecimento ? mc.conhecimento.nome : 'N/A' %></strong>
                                <div class="progress" style="width: 200px; height: 15px;">
                                    <div class="progress-bar" role="progressbar" 
                                         style="width: <%= mc.nivel * 10 %>%;" 
                                         aria-valuenow="<%= mc.nivel %>" aria-valuemin="0" aria-valuemax="10">
                                        Nível <%= mc.nivel %>
                                    </div>
                                </div>
                            </div>
                            <form action="/aluno/conhecimentos/deletar/<%= mc._id %>" method="POST" onsubmit="return confirm('Tem certeza?');">
                                <button type="submit" class="btn btn-sm btn-danger">Excluir</button>
                            </form>
                        </li>
                    <% }) %>
                <% } else { %>
                    <li class="list-group-item text-center text-muted">Você ainda não selecionou nenhum conhecimento.</li>
                <% } %>
            </ul>
        </div>
    </div>
</div>

<%- include('../partials/footer') %>